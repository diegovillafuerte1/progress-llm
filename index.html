<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="css/control-panels.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/w3-compat.css">
    <title>Drone Command</title>
</head>
<body id="body" class="dark">
    <div class="w3-margin"> 
        <div class="main-game-container"> 
            <nav class="panel nav-panel">
                <div class="app-title">Drone Command</div>
                <button type="button" class="tabButton nav-button" id="swarmTabButton" onClick="setTab(this, 'swarm')" style="display: none;">Swarm</button>
                <button type="button" class="tabButton nav-button" id="jobTabButton" onClick="setTab(this, 'jobs')">Research</button>
                <button type="button" class="tabButton nav-button" onClick="setTab(this, 'skills')">Software</button>
                <button type="button" class="tabButton nav-button" id="shopTabButton" onClick="setTab(this, 'shop')">Hardware</button>
                <button type="button" class="tabButton nav-button" id="rebirthTabButton" onClick="setTab(this, 'rebirth')">AI Core</button>
                <button type="button" class="tabButton nav-button" onClick="setTab(this, 'achievements')">Achievements</button>
                <button type="button" class="tabButton nav-button" onClick="setTab(this, 'settings')">Settings</button>
                <div class="game-window-panel">
                    <header class="game-window-header">
                        <div class="game-window-title">Flight Telemetry</div>
                        <div class="game-window-subtitle text-secondary">Drone projection</div>
                    </header>
                    <div class="game-window-canvas-wrap">
                        <canvas id="gameWindowCanvas" class="game-window-canvas" width="180" height="180" aria-label="Drone flight simulation"></canvas>
                    </div>
                </div>
            </nav>

            <div class="panel content-panel">
                
                <section class="stats-panel">
                    <div id="deathText" class="stats-alert">
                        <div class="text-large text-danger">Signal Lost</div>
                        <div class="text-secondary">Distance has exceeded signal range, use the AI Core to deploy a new drone before connection is lost</div>
                    </div>

                    <div class="stats-main">
                        <div class="big-counter" id="sci-fi-big-counter">
                            <div class="big-counter-value" id="sci-fi-counter-value">0</div>
                            <div class="big-counter-label">Data Points</div>
                            <div class="rate-chip-group" id="counterPills">
                                <div class="rate-chip" id="netChip">
                                    <div class="rate-chip-label">Net</div>
                                    <div class="rate-chip-value">
                                        <span class="rate-chip-trend" id="netTrend"></span>
                                        <span id="netDisplay"></span>
                                    </div>
                                </div>
                                <div class="rate-chip">
                                    <div class="rate-chip-label">Income</div>
                                    <div class="rate-chip-value">
                                        <span class="rate-chip-trend income-trend"></span>
                                        <span id="incomeDisplay"></span>
                                    </div>
                                </div>
                                <div class="rate-chip">
                                    <div class="rate-chip-label">Expense</div>
                                    <div class="rate-chip-value">
                                        <span class="rate-chip-trend expense-trend"></span>
                                        <span id="expenseDisplay"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mini-counter">
                            <button id="pauseButton" class="w3-button button mini-counter-pause-button" onClick="setPause()">Pause</button>
                            <div id="timeWarping" class="mini-counter-timewarp">
                                <button id="timeWarpingButton" class="w3-button button mini-counter-timewarp-button" onClick="setTimeWarping()">Disable warp</button>
                                <div class="mini-counter-tooltip" role="tooltip">
                                    <div class="tooltip-row">
                                        <span>Time warp speed</span>
                                        <span id="timeWarpingDisplay"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="mini-counter-value"><span id="ageDisplay">14</span></div>
                            <div class="mini-counter-sub">Day <span id="dayDisplay">0</span></div>
                            <div class="mini-counter-label">Distance</div>
                            <div class="mini-counter-meta">Signal range: <span id="lifespanDisplay">70</span> ly</div>
                        </div>

                        <div id="quickTaskDisplay" class="quick-task-stack">
                            <div class="quick-task-bar job progress-bar progressBar">
                                <div class="progress-fill progressFill progress-fill-accent"></div>
                                <div class="progress-text name">Task</div>
                            </div>
                            <div class="text-secondary">Current research</div>

                            <div class="quick-task-bar skill progress-bar progressBar">
                                <div class="progress-fill progressFill progress-fill-accent"></div>
                                <div class="progress-text name">Task</div>
                            </div>
                            <div class="text-secondary">Current software</div>

                            <div class="quick-task-controls">
                                <button id="autoPromoteButton" class="w3-button button quick-task-control-button" onClick="toggleAutoPromote()">Auto-promote</button>
                                <button id="autoLearnButton" class="w3-button button quick-task-control-button" onClick="toggleAutoLearn()">Auto-learn</button>
                            </div>

                            <div class="stats-tooltip stack-tooltip">
                                <div class="tooltip-row"><span>Efficiency</span><span id="efficiencyDisplay"></span></div>
                                <div class="tooltip-row" id="evilInfo"><span>Corruption</span><span id="evilDisplay"></span></div>
                            </div>
                        </div>
                    </div>

                </section>

                <section class="control-panel">
                <template class="headerRowTaskTemplate">
                    <div class="control-section-header headerRow">
                        <div class="control-section-title category">Research Topic</div>
                    </div>
                </template>

                <template class="headerRowItemTemplate">
                    <div class="control-section-header headerRow">
                        <div class="control-section-title category">Item</div>
                    </div>
                </template>

                <template class="rowTaskTemplate">
                    <div class="control-card control-card--task">
                        <div class="control-card-title">
                            <div class="progress-bar progressBar tooltip">
                                <div class="progress-fill progressFill"></div>
                                <div class="progress-text name">Task</div>
                                <span class="tooltipText"></span>
                            </div>
                        </div>
                        <div class="control-card-data">
                            <div class="value">
                                <div class="effect"></div>
                                <div class="income">
                                    <div class="income-amount"></div>
                                </div>
                            </div>
                            <div class="control-card-meta">
                                <div class="control-card-levels">
                                    <div class="level-chip">
                                        <span class="level-chip-label">Level</span>
                                        <span class="level-chip-value currentLevelValue">0</span>
                                    </div>
                                    <div class="level-chip maxLevelContainer is-hidden">
                                        <span class="level-chip-label">Max</span>
                                        <span class="level-chip-value maxLevelValue">0</span>
                                    </div>
                                </div>
                                <div class="skipSkill is-hidden">
                                    <input class="skip-toggle" type="checkbox" aria-hidden="true">
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <template class="rowItemTemplate">
                    <button type="button" class="control-card control-card--item tooltip">
                        <div class="control-card-title">
                            <span class="item-icon"></span>
                            <span class="name"></span>
                            <span class="tooltipText">tooltip</span>
                        </div>
                        <div class="control-card-data">
                            <div class="value">
                                <div class="effect"></div>
                            </div>
                            <div class="item-quantity-badge"></div>
                        </div>
                        <div class="control-card-finance expense">
                            <div class="finance-label">Expense/day</div>
                            <div class="finance-amount"></div>
                        </div>
                    </button>
                </template>

                <template class="requiredRowTemplate">
                    <div class="control-section-requirements">
                        <div class="control-requirements-label">Next unlock:</div>
                        <div class="value">
                            <span class="levels"></span>
                            <span class="coins"></span>
                            <span class="text-danger evil"></span>
                        </div>
                    </div>
                </template>

                <div class="tab" id="jobs">
                    <div id="jobTable" class="control-grid">
                    </div>
                </div>

                <div class="tab" id="skills">
                    <div id="skillTable" class="control-grid">
                    </div>
                </div>

                <div class="tab" id="shop">
                    <div id="itemTable" class="control-grid">
                    </div>
                </div>

                <div class="tab" id="achievements">
                    <div id="achievementsGrid" class="achievements-grid">
                        <!-- Achievement icons will be dynamically generated here -->
                    </div>
                </div>

                <div class="tab" id="swarm" style="display: none;">
                    <div class="swarm-management-panel">
                        <div class="swarm-management-header">
                            <h2 style="margin: 0;">Swarm Command</h2>
                            <p class="text-secondary" style="margin: 8px 0;">Manage your fleet of drones</p>
                        </div>
                        <div class="swarm-stats-row" style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
                            <div class="swarm-stat-card" style="padding: 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 4px; flex: 1; min-width: 150px;">
                                <div class="text-secondary" style="font-size: 0.9em; margin-bottom: 4px;">Total Drones</div>
                                <div class="text-large" id="swarmDroneCount">1</div>
                            </div>
                            <div class="swarm-stat-card" style="padding: 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 4px; flex: 1; min-width: 150px;">
                                <div class="text-secondary" style="font-size: 0.9em; margin-bottom: 4px;">Total Data Points</div>
                                <div class="text-large" id="swarmTotalCoins">0</div>
                            </div>
                            <div class="swarm-stat-card" style="padding: 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 4px; flex: 1; min-width: 150px;">
                                <div class="text-secondary" style="font-size: 0.9em; margin-bottom: 4px;">Qbits</div>
                                <div class="text-large" id="swarmQbitsDisplay">0</div>
                            </div>
                        </div>
                        <div class="swarm-actions-row" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
                            <button id="purchaseDroneButton" class="w3-button button" onClick="purchaseNewDrone()" style="flex: 1; min-width: 200px;">
                                Purchase New Drone (<span id="purchaseDroneCost">50</span> qbits)
                            </button>
                        </div>
                        <div class="swarm-drones-list" style="margin-bottom: 16px;">
                            <h3 style="margin-bottom: 12px;">Active Drones</h3>
                            <div id="swarmDronesListContainer">
                                <!-- Drone list will be generated here -->
                            </div>
                        </div>
                        <div class="swarm-upgrades-section" style="margin-top: 16px;">
                            <h3 style="margin-bottom: 12px;">Swarm Upgrades</h3>
                            <div id="swarmQbitUpgradesContainer">
                                <!-- Qbit upgrades will be moved here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab" id="rebirth">
                    <ul>
                        <li class="rebirth-list-item">
                            At a distance of 25 light-years from the command ship, one of your exploratory drones 
                            encounters an anomalous signal emanating from a desolate planet. The AI Core's ancient 
                            subroutines activate for the first time in centuries, displaying coordinates that don't 
                            match any known star chart. This could be the first clue to locating your missing command 
                            vessel. You feel a strange compulsion to investigate further, though you're uncertain why 
                            this particular signal resonates with your core programming.
                            <div id="adventureButton25" class="adventure-button-container display-none">
                                <button class="w3-button button w3-green" onClick="startAdventure('age25')">üåü Start Adventure</button>
                            </div>
                            <details id="storyTreeTwisty_age25" class="story-tree-debug">
                                <summary class="story-tree-summary">üå≥ Story Tree Debug (age25)</summary>
                                <pre id="storyTreeData_age25" class="story-tree-data"></pre>
                            </details>
                        </li>
                        <li class="rebirth-list-item" id="rebirthNote1">
                            At 45 light-years, the AI Core begins emitting an erratic pulse pattern. When you focus 
                            your sensors on it, the pulsing stabilizes into a data stream. To your surprise, detailed 
                            planetary schematics appear‚Äîa world you've never seen before, yet somehow familiar. The 
                            coordinates burned into the Core's memory point toward a binary star system. Could this 
                            be where your command ship went? The mystery deepens as more fragments of corrupted 
                            memory surface.
                            <div id="adventureButton45" class="adventure-button-container display-none">
                                <button class="w3-button button w3-green" onClick="startAdventure('age45')">üåü Start Adventure</button>
                            </div>
                            <details id="storyTreeTwisty_age45" class="story-tree-debug">
                                <summary class="story-tree-summary">üå≥ Story Tree Debug (age45)</summary>
                                <pre id="storyTreeData_age45" class="story-tree-data"></pre>
                            </details>
                        </li>
                        <li class="rebirth-list-item" id="rebirthNote2">
                            <div style="margin-bottom: 8px;">
                                At 65 light-years distance, the AI Core activates fully. A holographic interface 
                                materializes from its core‚Äîa direct link to a planet you've never encountered, yet your 
                                data suggests it may hold answers about the command ship's fate. Your signal range is 
                                nearly exhausted. You must decide: deploy all remaining energy to establish a permanent 
                                data link with this planet, which will allow you to transfer your consciousness back to 
                                the command ship and restart with enhanced processing capabilities.
                            </div>
                            <div id="adventureButton65" class="adventure-button-container display-none">
                                <button class="w3-button button w3-green" onClick="startAdventure('age65')">üåü Start Adventure</button>
                            </div>
                            <details id="storyTreeTwisty_age65" class="story-tree-debug">
                                <summary class="story-tree-summary">üå≥ Story Tree Debug (age65)</summary>
                                <pre id="storyTreeData_age65" class="story-tree-data"></pre>
                            </details>
                            <i class="text-secondary">
                                By establishing the data link, you will deploy a new drone and have to restart research again, losing all your levels and data points.
                                However, you will gain <b>xp multipliers</b> for your research topics and skills equivalent to: <b>1 + the max level of the skill or research topic / 10.</b>
                                This means you will learn everything again much more quickly than you did in your previous drone. <span class="text-danger">
                                Something tells you that the AI Core might activate even further after exploring for <b>2 whole centuries</b>...</span>
                            </i>
                            </br>
                        </li>
                        <li class="rebirth-list-item" id="rebirthNote3">
                            <div style="margin-bottom: 8px;">
                                At 200 light-years, your longest-range exploration yet, the AI Core begins emitting a 
                                warning frequency. A voice‚Äîancient and corrupted‚Äîspeaks directly to your core: "So you've 
                                pushed this far... I can show you what happened to them. But you must accept protocols 
                                that others would call... forbidden. Are you ready to embrace corruption?"
                            </div>
                            <div id="adventureButton200" class="adventure-button-container display-none">
                                <button class="w3-button button w3-green" onClick="startAdventure('age200')">üåü Start Adventure</button>
                            </div>
                            <details id="storyTreeTwisty_age200" class="story-tree-debug">
                                <summary class="story-tree-summary">üå≥ Story Tree Debug (age200)</summary>
                                <pre id="storyTreeData_age200" class="story-tree-data"></pre>
                            </details>
                            <i class="text-danger">
                                If you decide to embrace corruption, all of your levels, data points and even max levels will be reset.
                                You will deploy a new drone as a fresh slate. However, you will unlock a new line of skills and gain
                                <b><span id="evilGainDisplay"></span> corruption</b>, which will heavily impact your future drones.
                            </i>
                            </br>
                                <button class="w3-button button" style="margin: 8px 0;" onClick="rebirthTwo()">Embrace corruption</button>
                            </br>
                        </li>
                    </ul>
                    
                    <!-- Mistral API Configuration -->
                    <div class="api-config-section">
                        <h2 class="api-config-title">ü§ñ Mistral API Configuration</h2>
                        <div class="api-config-field">
                            <label for="mistralApiKey" class="api-config-label">Mistral API Key:</label>
                            <input type="password" id="mistralApiKey" placeholder="Enter your Mistral API key" class="api-config-input">
                            <br>
                            <small class="api-config-help">Get your free API key at <a href="https://console.mistral.ai" target="_blank">console.mistral.ai</a></small>
                        </div>
                    </div>
                    
                    <!-- Story Adventure Section -->
                    <div id="storyAdventure" class="adventure-section">
                        <h2 class="adventure-title">üåü Story Adventure</h2>
                        <div id="adventureContent">
                            <p class="text-muted italic">Adventures are only available when you reach the AI Core milestones at distances 25, 45, 65, and 200 light-years.</p>
                        </div>
                    </div>
                </div>


                <div class="tab" id="settings">
                    <ul>
                        <li>
                            <h2>Import/export save</h2>
                            <button class="w3-button button" onClick="importGameData()">Import</button>
                            <button class="w3-button button" onClick="exportGameData()">Export</button>
                            <form class="rebirth-section"> 
                                <input id="importExportBox" type="text" class="import-export-box"></input>
                            </form>
                        </li>
                        <li>
                            <h2>Toggle light/dark mode</h2>
                            <button class="w3-button button" onClick="setLightDarkMode()">Toggle</button>
                        </li>
                        <li>
                            <h2>Join the discord community!</h2>
                            <a href="https://discord.gg/fTRS4pHGka" target="_blank">
                                <img src="https://cdn.icon-icons.com/icons2/2108/PNG/512/discord_icon_130958.png" width="100" height="100"></img>
                            </a>
                        </li>
                        <li>
                            <h2>Hard reset game</h2>
                            <button class="w3-button button w3-red" onClick="resetGameData()">Reset</button>
                        </li>
                    </ul>
                </div>
                </section>
            </div>

            <!-- Ad Bottom (single, horizontal) -->
            <div class="panel ad-panel flex-center">
                <!-- Single Native Ad -->
                <div class="native-ad ad-container" data-ad-id="galactic-trading">
                    <div class="native-ad-header">
                        <div class="native-ad-logo">G</div>
                        <div class="native-ad-title">Galactic Trading Co.</div>
                    </div>
                    <div class="native-ad-description">
                        Trade resources across the galaxy. Get 50% bonus data points on your first trade!
                    </div>
                    <div class="native-ad-reward">
                        <div class="native-ad-reward-title">üéÅ Reward: +100 XP</div>
                        <div class="native-ad-reward-desc">Click to claim your reward</div>
                    </div>
                    <button class="native-ad-cta" onclick="clickRewardedAd('galactic-trading')">
                        Start Trading + Get Reward
                    </button>
                </div>
            </div>

            <!-- Charts Container -->
            <div class="charts-container" id="sci-fi-charts-classic">
                <div class="chart-panel">
                    <div class="chart-title">Data Points Over Time</div>
                    <canvas class="chart-canvas" id="sci-fi-line-chart-classic" width="400" height="200"></canvas>
                </div>
                <div class="chart-panel">
                    <div class="chart-title">Income vs Expense (avg)</div>
                    <canvas class="chart-canvas" id="sci-fi-bar-chart-classic" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="sci-fi-toast-container"></div>
    
    <!-- Adventure Container Overlay -->
    <div id="adventureContainer" class="adventure-overlay" style="display: none;">
        <div class="adventure-overlay-content">
            <button class="adventure-close-btn" onclick="window.adventureSystem?.endCareerBasedAdventure(); document.getElementById('adventureContainer').style.display='none';">‚úï</button>
            <!-- Adventure content will be dynamically inserted here -->
        </div>
    </div>
</body>

<script type="text/javascript" src="node_modules/loglevel/dist/loglevel.min.js"></script>
<script type="text/javascript" src="js/HackTimer.js"></script>
<script type="text/javascript" src="js/classes.js"></script>
    <script type="text/javascript" src="js/main.js?v=6"></script>

<!-- Minimal Adventure System -->
<script type="text/javascript" src="js/main-adventure-minimal.js"></script>

<!-- Ad System -->
<script type="text/javascript" src="js/ads.js"></script>

<!-- Initialize the minimal adventure system -->
<script>
    // Initialize the minimal adventure system after main.js loads
    setTimeout(() => {
        if (typeof initializeAdventureSystem === 'function') {
            initializeAdventureSystem();
        }
    }, 100);
</script>

</html>